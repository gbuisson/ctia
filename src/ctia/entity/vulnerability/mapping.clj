(ns ctia.entity.vulnerability.mapping
  (:require [ctia.stores.es.mapping :as em]))

(def cve
  {:properties
   {:cve_data_meta
    {:properties
     {:assigner em/token
      :id em/token}}}})

(def impact
  {:properties
   {:exploitability_score {:type "float"}
    :impact_score {:type "float"}
    :cvss_v3
    {:properties
     {:vector_string em/token
      :attack_vector em/token
      :modified_attack_vector em/token
      :attack_complexity em/token
      :confidentiality_requirement em/token
      :report_confidence em/token
      :modified_attack_complexity em/token
      :privileges_required em/token
      :modified_privileges_required em/token
      :user_interaction em/token
      :modified_user_interaction em/token
      :scope em/token
      :modified_scope em/token
      :availability_requirement em/token
      :confidentiality_impact em/token
      :modified_confidentiality_impact em/token
      :integrity_impact em/token
      :modified_integrity_impact em/token
      :environmental_severity em/token
      :availability_impact em/token
      :modified_availability_impact em/token
      :exploit_code_maturity em/token
      :base_score {:type "float"}
      :base_severity em/token
      :temporal_score {:type "float"}
      :environmental_score {:type "float"}
      :remediation_level em/token
      :temporal_severity {:type "float"}
      :integrity_requirement em/token}}}})

(def vulnerability-mapping
  {"weakness"
   {:dynamic false
    :include_in_all false
    :properties
    (merge
     em/base-entity-mapping
     em/describable-entity-mapping
     em/sourcable-entity-mapping
     em/stored-entity-mapping
     {:description em/token
      :name em/token
      :cve cve
      :impact impact
      :severity em/token
      :published_date em/ts
      :last_modified_date em/ts
      :tlp em/token})}})
